<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AR Minimal</title>
  <!-- A-Frame & MindAR（安定版） -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    html,body{margin:0;padding:0;background:#000;overflow:hidden}
    #start{position:fixed;right:12px;bottom:12px;z-index:3;background:#fff;color:#111;
      border:0;border-radius:12px;padding:10px 14px;font-weight:700}
  </style>
</head>
<body>
  <!-- iOSの黒画面回避（手動起動） -->
  <button id="start">カメラ開始</button>

  <!-- 最小：MindARの画像ターゲットだけ。autoStartは切って手動で開始 -->
  <a-scene
    mindar-image="imageTargetSrc: targets.mind?v=1; autoStart: false"
    vr-mode-ui="enabled:false"
    device-orientation-permission-ui="enabled:false">

    <a-assets>
      <img id="overlay" src="real-itinerary.png">
    </a-assets>

    <a-camera look-controls="enabled:false"></a-camera>

    <!-- ターゲット0の上に画像をそのまま乗せるだけ -->
    <a-entity mindar-image-target="targetIndex: 0">
      <a-plane id="pane" src="#overlay" position="0 0 0" rotation="0 0 0"></a-plane>
    </a-entity>
  </a-scene>

  <script>
    // 画像の比率で平面サイズを幅=1, 高さ=比率に合わせる（必須最小）
    const img=document.getElementById('overlay'), pane=document.getElementById('pane');
    function fit(){
      if(!img.naturalWidth||!img.naturalHeight) return;
      const r=img.naturalHeight/img.naturalWidth;
      pane.setAttribute('width',1);
      pane.setAttribute('height',r);
    }
    if (img.complete && img.naturalWidth) fit(); else img.addEventListener('load', fit);

    // 手動でカメラ開始（iOSの自動起動ブロック対策）
    const btn=document.getElementById('start');
    const scene=document.querySelector('a-scene');
    async function start(){
      try{ await scene.systems['mindar-image-system'].start(); btn.style.display='none'; }
      catch(e){ alert('カメラ起動に失敗: '+(e?.message||e)); console.error(e); }
    }
    btn.addEventListener('click', start);
    // どこか一度タップでも開始（保険）
    document.addEventListener('pointerdown', ()=>start(), {once:true});
  </script>
</body>
</html>
